<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_move_form_fp_fields" model="ir.ui.view">
        <field name="name">account.move.form.fp.fields</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button name="action_fp_send_to_api" string="Enviar a Hacienda" type="object" class="oe_highlight" invisible="not fp_is_electronic_invoice or fp_api_state != 'pending'"/>
                <button name="action_fp_consult_api_document" string="Consultar Hacienda" type="object" invisible="not fp_is_electronic_invoice or fp_api_state in ('done','error')"/>
            </xpath>
            <xpath expr="//field[@name='invoice_date']" position="after">
                <field name="fp_is_electronic_invoice" invisible="1"/>
                <field
                    name="fp_document_type"
                    invisible="not fp_is_electronic_invoice or move_type == 'out_refund'"
                    readonly="fp_api_state != 'pending'"
                />
                <field
                    name="fp_document_type"
                    invisible="not fp_is_electronic_invoice or move_type != 'out_refund'"
                    readonly="1"
                />
                <field name="fp_economic_activity_id" invisible="not fp_is_electronic_invoice" readonly="fp_api_state != 'pending'"/>
                <field name="fp_sale_condition" invisible="not fp_is_electronic_invoice" readonly="fp_api_state != 'pending'"/>
                <field name="fp_payment_method" invisible="not fp_is_electronic_invoice" readonly="fp_api_state != 'pending'"/>
                <field name="fp_external_id" readonly="1" invisible="not fp_is_electronic_invoice"/>
                <field name="fp_api_state" readonly="1" invisible="1"/>
                <label for="fp_consecutive_number" invisible="not fp_is_electronic_invoice"/>
                <div class="o_row" invisible="not fp_is_electronic_invoice">
                    <field name="fp_consecutive_number" readonly="1" nolabel="1"/>
                    <button
                        name="action_fp_open_hacienda_documents"
                        type="object"
                        class="btn-link px-0 ms-1"
                        icon="fa-external-link"
                        invisible="not fp_consecutive_number"
                        title="Abrir documentos en Hacienda"
                    />
                </div>
                <field name="fp_invoice_status" readonly="1" invisible="not fp_is_electronic_invoice"/>
            </xpath>

            <xpath expr="//notebook" position="inside">
                <page string="InformaciÃ³n de referencia FE" invisible="fp_document_type != 'NC' or not fp_is_electronic_invoice">
                    <group col="2">
                        <field name="fp_reference_document_type" required="fp_document_type == 'NC' and fp_is_electronic_invoice"/>
                        <field name="fp_reference_number" required="fp_document_type == 'NC' and fp_is_electronic_invoice"/>
                        <field name="fp_reference_issue_datetime" required="fp_document_type == 'NC' and fp_is_electronic_invoice"/>
                        <field name="fp_reference_code" required="fp_document_type == 'NC' and fp_is_electronic_invoice"/>
                        <field name="fp_reference_reason" required="fp_document_type == 'NC' and fp_is_electronic_invoice"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <record id="view_out_invoice_tree_fp_fields" model="ir.ui.view">
        <field name="name">account.move.list.out.invoice.fp.fields</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_out_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='invoice_date']" position="after">
                <field name="fp_consecutive_number" string="Consecutivo" optional="show"/>
            </xpath>
            <xpath expr="//field[@name='status_in_payment']" position="after">
                <field
                    name="fp_invoice_status"
                    string="Estado FE"
                    widget="badge"
                    decoration-success="fp_invoice_status == 'accepted'"
                    decoration-danger="fp_invoice_status == 'rejected'"
                    decoration-warning="fp_invoice_status == 'sent'"
                    optional="show"
                />
            </xpath>
        </field>
    </record>
</odoo>
